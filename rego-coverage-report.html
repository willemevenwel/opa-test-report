<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polly Rego Testing & Coverage Report</title>
  
  <script id="generation-js">

  // --- Dynamic coverage report generation ---
  document.addEventListener('DOMContentLoaded', function () {
    // --- Coverage summary and policy cards ---
    fetch('/coverage.json')
    .then(function(response) { return response.json(); })
    .then(function(data) {
      document.getElementById('totalPolicies').textContent = data.totalPolicies || Object.keys(data.files || {}).length || 0;
      document.getElementById('totalCoveragePercentage').textContent = (data.totalCoveragePercentage || data.coverage || '0') + '%';
      document.getElementById('totalCoveredLines').textContent = data.totalCoveredLines || data.covered_lines || 0;
      document.getElementById('totalNotCoveredLines').textContent = data.totalNotCoveredLines || data.not_covered_lines || 0;

      var ul = document.getElementById('coverage-details');
      var templateLi = ul.querySelector('li');
      if (!templateLi) return;
      var template = templateLi.cloneNode(true);
      ul.innerHTML = '';

      function getLineStatusMap(policy) {
        var statusMap = {};
        if (Array.isArray(policy.ignored)) {
          policy.ignored.forEach(function(r) {
            for (var i = r.start.row; i <= (r.end.row || r.start.row); i++) statusMap[i] = 'ignored';
          });
        }
        if (Array.isArray(policy.covered)) {
          policy.covered.forEach(function(r) {
            for (var i = r.start.row; i <= (r.end.row || r.start.row); i++) if (!statusMap[i]) statusMap[i] = 'covered';
          });
        }
        if (Array.isArray(policy.not_covered)) {
          policy.not_covered.forEach(function(r) {
            for (var i = r.start.row; i <= (r.end.row || r.start.row); i++) if (!statusMap[i]) statusMap[i] = 'missed';
          });
        }
        return statusMap;
      }

      Object.entries(data.files || {}).forEach(function([path, policy], idx) {
        policy.path = path;
        var li = template.cloneNode(true);
        if (idx > 0) {
          var rawDiv = li.querySelector('#coverage-raw');
          if (rawDiv) rawDiv.remove();
        }
        var h2 = li.querySelector('h2');
        if (h2) {
          var name = path.split('/').pop();
          h2.innerHTML =
            name +
            ' <span class="policy-path">(' + path + ')</span>';
        }
        var coveredPerc = li.querySelector('.covered-percentage');
        if (coveredPerc) coveredPerc.textContent = (policy.coverage || 0) + '%';
        var uncoveredLines = li.querySelector('.uncovered-lines');
        if (uncoveredLines) {
          var uncoveredCount = policy.not_covered_lines || 0;
          if (uncoveredCount > 0) {
            uncoveredLines.innerHTML = '<strong>Uncovered lines:</strong> <span class="has-uncovered">' + uncoveredCount + '</span>';
          } else {
            uncoveredLines.innerHTML = '<strong>Uncovered lines:</strong> ' + uncoveredCount;
          }
        }
        var coveredLines = li.querySelector('.covered-lines');
        if (coveredLines) coveredLines.innerHTML = '<strong>Covered lines:</strong> ' + (policy.covered_lines || 0);
        var totalLines = li.querySelector('.total-lines');
        if (totalLines) totalLines.innerHTML = '<strong>Total lines:</strong> ' + ((policy.covered_lines || 0) + (policy.not_covered_lines || 0));

        var codeTable = li.querySelector('.code-table tbody');
        if (codeTable) {
          codeTable.innerHTML = '';
          fetch('/' + path)
            .then(function(resp) { return resp.ok ? resp.text() : ''; })
            .then(function(text) {
              var lines = text.split('\n');
              var statusMap = getLineStatusMap(policy);
              lines.forEach(function(line, idx) {
                var tr = document.createElement('tr');
                var lineNumber = idx + 1;
                var trimmed = line.trim();
                var isComment = trimmed.startsWith('#');
                var isImport = trimmed.startsWith('import ');
                var isIgnored =
                  trimmed === '' ||
                  trimmed === '}' ||
                  trimmed.startsWith('package ') ||
                  isImport ||
                  isComment ||
                  statusMap[lineNumber] === 'ignored';
                if (isIgnored) {
                  tr.className = 'ignored';
                } else if (statusMap[lineNumber] === 'covered') {
                  tr.className = 'covered';
                } else if (statusMap[lineNumber] === 'missed') {
                  tr.className = 'missed';
                }
                var tdLn = document.createElement('td');
                tdLn.className = 'ln';
                tdLn.innerHTML = '<a id="L' + lineNumber + '" href="#L' + lineNumber + '">' + lineNumber + '</a>';
                var tdCode = document.createElement('td');
                tdCode.className = 'code';
                tdCode.textContent = line;
                tr.appendChild(tdLn);
                tr.appendChild(tdCode);
                codeTable.appendChild(tr);
              });
            });
        }
        ul.appendChild(li);
      });

      // Initialize toggle icons for dynamically created cards
      document.querySelectorAll('.card').forEach(function(card) {
        var summary = card.querySelector('summary');
        var icon = summary && summary.querySelector('.toggle-icon');
        if (icon) {
          if (card.open) {
            icon.style.transform = 'rotate(90deg)'; // Rotate right-arrow to point down when open
          } else {
            icon.style.transform = 'rotate(0deg)'; // Right-arrow points right when closed
          }
        }
      });

      var rawPre = document.querySelector('#coverage-raw pre');
      if (rawPre) {
        rawPre.textContent = JSON.stringify(data, null, 2);
      }
    })
    .catch(function(err) {
      console.error('Failed to load coverage.json', err);
    });

  // --- Verbose table and raw section ---
  fetch('/verbose.txt')
    .then(function(response) { if (!response.ok) return null; return response.text(); })
    .then(function(text) {
      if (!text) return;
      var lines = text.split('\n');
      var tableData = [];
      var currentFile = null;
      var fileHeaderRe = /^([\w\/-]+\.rego):$/;
      var testLineRe = /^([^\s:]+):\s+(PASS|FAIL)\s+\(([^)]+)\)$/;
      lines.forEach(function(line) {
        var fileMatch = line.match(fileHeaderRe);
        if (fileMatch) {
          currentFile = fileMatch[1];
          return;
        }
        var testMatch = line.match(testLineRe);
        if (testMatch && currentFile) {
          tableData.push({
            file: currentFile,
            test: testMatch[1],
            result: testMatch[2],
            time: testMatch[3]
          });
        }
      });
      if (!tableData.length) return;
      var table = document.getElementById('table-verbose');
      if (!table) return;
      var tbody = document.createElement('tbody');
      tableData.forEach(function(row) {
        var tr = document.createElement('tr');
        var statusClass = 'status-other';
        if (row.result === 'PASS') statusClass = 'status-pass';
        else if (row.result === 'FAIL') statusClass = 'status-fail';
        var timeClass = '';
        var msMatch = row.time.match(/^([0-9]+)\s*ms$/i);
        if (msMatch && parseInt(msMatch[1], 10) > 100) timeClass = 'time-slow';
        var tdTest = document.createElement('td');
        tdTest.textContent = row.test;
        var tdStatus = document.createElement('td');
        tdStatus.textContent = row.result;
        tdStatus.className = statusClass;
        var tdTime = document.createElement('td');
        tdTime.textContent = row.time;
        if (timeClass) tdTime.className = timeClass;
        tr.appendChild(tdTest);
        tr.appendChild(tdStatus);
        tr.appendChild(tdTime);
        tbody.appendChild(tr);
      });
      // Remove old tbody if present
      var oldTbody = table.querySelector('tbody');
      if (oldTbody) table.removeChild(oldTbody);
      table.appendChild(tbody);

      // Fill the verbose raw <pre>
      var verbosePre = document.querySelector('#verbose-raw pre');
      if (verbosePre) verbosePre.textContent = text;
    });
});
  </script>
  
  <script id="main-js">


    // --- Highlight toggle and copy-to-clipboard logic for policy cards ---
    document.addEventListener('DOMContentLoaded', function () {
      
      // Tooltip functionality
      function createTooltip(element, message) {
        // Remove any existing tooltip
        var existingTooltip = document.querySelector('.tooltip');
        if (existingTooltip) {
          existingTooltip.remove();
        }

        var tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.textContent = message;
        document.body.appendChild(tooltip);

        // Position tooltip above the element
        var rect = element.getBoundingClientRect();
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        var scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
        
        // Get tooltip dimensions after adding to DOM
        var tooltipRect = tooltip.getBoundingClientRect();
        
        // Calculate position with scroll offset
        var left = rect.left + scrollLeft + rect.width / 2 - tooltipRect.width / 2;
        var top = rect.top + scrollTop - tooltipRect.height - 10;
        
        // Ensure tooltip stays within viewport
        var viewportWidth = window.innerWidth || document.documentElement.clientWidth;
        if (left < 5) left = 5;
        if (left + tooltipRect.width > viewportWidth - 5) left = viewportWidth - tooltipRect.width - 5;
        
        tooltip.style.left = left + 'px';
        tooltip.style.top = top + 'px';

        // Show tooltip with animation
        setTimeout(function() {
          tooltip.classList.add('show');
        }, 10);

        // Hide tooltip after 2 seconds
        setTimeout(function() {
          if (tooltip && tooltip.parentNode) {
            tooltip.classList.remove('show');
            setTimeout(function() {
              if (tooltip && tooltip.parentNode) {
                tooltip.remove();
              }
            }, 300);
          }
        }, 2000);
      }

      // Function to update toggle icon based on details state
      function updateToggleIcon(detailsElement) {
        var icon = detailsElement.querySelector('.toggle-icon');
        if (icon) {
          if (detailsElement.open) {
            icon.style.transform = 'rotate(90deg)'; // Point down when open
          } else {
            icon.style.transform = 'rotate(0deg)'; // Point right when closed
          }
        }
      }

      // Initialize all toggle icons on page load
      function initializeToggleIcons() {
        document.querySelectorAll('details.card, details.expandable').forEach(function(details) {
          updateToggleIcon(details);
        });
      }

      // Call initialization immediately and after a short delay for static content
      initializeToggleIcons();
      setTimeout(initializeToggleIcons, 100);

      // Use event delegation to handle dynamically created content
      document.addEventListener('click', function(e) {
        // Handle details toggle clicks manually to ensure icon updates
        if (e.target.closest('summary')) {
          var summary = e.target.closest('summary');
          var details = summary.closest('details');
          if (details && (details.classList.contains('card') || details.classList.contains('expandable'))) {
            // Use setTimeout to update icon after the details state changes
            setTimeout(function() {
              updateToggleIcon(details);
            }, 10);
          }
        }

        // Eye button for highlight toggle
        if (e.target.closest('.eye-btn')) {
          e.preventDefault();
          e.stopPropagation();
          var eyeBtn = e.target.closest('.eye-btn');
          var card = eyeBtn.closest('.card');
          var codeWrap = card.querySelector('.code-wrap');
          if (codeWrap) {
            var isHiding = !codeWrap.classList.contains('highlight-off');
            codeWrap.classList.toggle('highlight-off');
            
            // Show appropriate tooltip
            var tooltipMessage = isHiding ? "Highlighting of lines hidden." : "Highlighting of lines shown.";
            createTooltip(eyeBtn, tooltipMessage);
            
            // Animate the eye icon (swap SVG for open/closed)
            var svg = eyeBtn.querySelector('svg');
            if (codeWrap.classList.contains('highlight-off')) {
              eyeBtn.classList.add('eye-closed');
            } else {
              eyeBtn.classList.remove('eye-closed');
            }
            eyeBtn.classList.add('btn-animate');
            setTimeout(function(){ eyeBtn.classList.remove('btn-animate'); }, 250);
          }
        }
        
        // Copy button for code
        if (e.target.closest('.copy-btn')) {
          e.preventDefault();
          e.stopPropagation();
          var copyBtn = e.target.closest('.copy-btn');
          
          // Handle expandable section copy (coverage-raw and verbose-raw)
          var expandable = copyBtn.closest('details.expandable');
          if (expandable) {
            var pre = expandable.querySelector('pre');
            if (pre) {
              var text = pre.innerText || pre.textContent;
              if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(function() {
                  // Determine which type of raw content this is
                  var coverageRaw = copyBtn.closest('#coverage-raw');
                  var verboseRaw = copyBtn.closest('#verbose-raw');
                  var tooltipMessage = 'Raw content copied to clipboard.';
                  
                  if (coverageRaw) {
                    tooltipMessage = 'Raw coverage report copied to clipboard.';
                  } else if (verboseRaw) {
                    tooltipMessage = 'Raw verbose report copied to clipboard.';
                  }
                  
                  createTooltip(copyBtn, tooltipMessage);
                  copyBtn.classList.add('btn-animate');
                  setTimeout(function(){ 
                    copyBtn.classList.remove('btn-animate'); 
                  }, 1200);
                });
              }
            }
            return; // Add this return to prevent executing the policy card copy logic
          }

          // Handle policy card copy
          var card = copyBtn.closest('.card');
          if (card) {
            var codeTable = card.querySelector('.code-table');
            if (codeTable) {
              var lines = Array.from(codeTable.querySelectorAll('td.code')).map(function(td) {
                return td.innerText || td.textContent;
              });
              var text = lines.join('\n');
              if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(function() {
                  // Get policy name and path for tooltip
                  var policyTitle = card.querySelector('.policy-title');
                  var policyName = '';
                  var policyPath = '';
                  
                  if (policyTitle) {
                    var titleText = policyTitle.textContent || policyTitle.innerText;
                    var pathSpan = policyTitle.querySelector('.policy-path');
                    if (pathSpan) {
                      var pathText = pathSpan.textContent || pathSpan.innerText;
                      policyPath = pathText.replace(/[()]/g, ''); // Remove parentheses
                      policyName = titleText.replace(pathText, '').trim();
                    } else {
                      policyName = titleText;
                    }
                  }
                  
                  var tooltipMessage = policyPath ? 
                    policyPath.charAt(0).toUpperCase() + policyPath.slice(1) + ' content copied to clipboard.' : 
                    policyName.charAt(0).toUpperCase() + policyName.slice(1) + ' content copied to clipboard.';
                  
                  createTooltip(copyBtn, tooltipMessage);
                  copyBtn.classList.add('btn-animate');
                  setTimeout(function(){ 
                    copyBtn.classList.remove('btn-animate'); 
                  }, 1200);
                });
              }
              return;
            }
          }
          
        }
      });

      // --- Policy expand/collapse/auto buttons ---
      var btnAuto = document.getElementById('coverage-btn-auto');
      var btnExpand = document.getElementById('coverage-btn-expand');
      var btnCollapse = document.getElementById('coverage-btn-collapse');
      function getPolicyCards() {
        // All details elements with .card class that have code tables
        return Array.from(document.querySelectorAll('details.card'));
      }
      if (btnExpand) {
        btnExpand.addEventListener('click', function() {
          getPolicyCards().forEach(function(card) { 
            card.open = true; 
            updateToggleIcon(card);
          });
        });
      }
      if (btnCollapse) {
        btnCollapse.addEventListener('click', function() {
          getPolicyCards().forEach(function(card) { 
            card.open = false; 
            updateToggleIcon(card);
          });
        });
      }
      if (btnAuto) {
        btnAuto.addEventListener('click', function() {
          getPolicyCards().forEach(function(card) {
            // Expand if there are any missed lines in the code-table
            var missed = card.querySelector('tr.missed');
            card.open = !!missed;
            updateToggleIcon(card);
          });
        });
      }


    });

    // --- Animation styles for buttons ---
    // Moved to static CSS section for better performance


</script>
  
  <style>
    /* SonarQube-like theme variables */
    :root {
      --sq-bg: #f5f5f5;
      --sq-card: #fff;
      --sq-border: #e5e5e5;
      --sq-primary: #4e91f9;
      --sq-muted: #888;
      --sq-header: #232c3b;
      --sq-table-header: #f0f4f8;
      --sq-success: #4caf50;
      --sq-fail: #e53935;
      --sq-font: 'Segoe UI', 'Arial', sans-serif;
      --covered-bg: #e6ffe6;
      --uncovered-bg: #ffe6e6;
      --ignored-bg: #e6f0ff;
      --slow-bg: #ffeacc;
    }

    /* Base layout */
    body {
      background: var(--sq-bg);
      color: #222;
      font-family: var(--sq-font);
      margin: 0;
      padding: 0;
    }
    header {
      background: var(--sq-header);
      color: #fff;
      padding: 18px 32px;
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-logo {
      height: 40px;
      width: auto;
      opacity: 0.9;
    }
    main {
      max-width: 900px;
      margin: 32px auto;
      background: var(--sq-card);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      padding: 32px 28px 40px 28px;
      border: 1px solid var(--sq-border);
    }
    h1, h2, h3 {
      color: var(--sq-header);
      margin-top: 0;
    }
    ul, li {
      all: unset;
      display: block;
    }

    /* Card components - consolidated */
    .card {
      border: 1.5px solid #bbb;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      background: #fff;
    }
    .expandable {
      box-sizing: border-box;
      border: 1px solid #bbb;
      border-radius: 4px;
      background: #fafbfc;
      padding: 10px;
    }
    .main-section {
      border: 2px solid #bbb;
      border-radius: 8px;
      margin-bottom: 32px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      padding: 18px 20px 24px 20px;
    }

    /* Toggle icons - consolidated */
    .toggle-icon {
      display: inline-block;
      width: 18px;
      height: 18px;
      margin-right: 6px;
      transition: transform 0.2s;
    }

    /* Tables */
    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 32px;
      background: var(--sq-table-header);
      border-radius: 6px 6px 0 0;
      overflow: hidden;
    }
    .summary-table th, .summary-table td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--sq-border);
      text-align: left;
      font-size: 1rem;
    }
    .summary-table th {
      background: var(--sq-table-header);
      color: var(--sq-header);
      font-weight: 600;
    }
    .summary-table tr:last-child td {
      border-bottom: none;
    }

    /* Status indicators - consolidated */
    .status-success,
    .status-pass,
    tr.covered td.code {
      background: var(--covered-bg) !important;
    }
    .status-fail,
    tr.missed td.code {
      background: var(--uncovered-bg) !important;
    }
    .ignored-swatch,
    tr.ignored td.code {
      background: var(--ignored-bg) !important;
    }
    .time-slow {
      background: var(--slow-bg) !important;
      color: #222 !important;
      font-weight: bold;
    }

    /* Status text colors */
    .status-pass,
    .status-fail,
    .time-slow {
      color: #222 !important;
    }
    .coverage-pass {
      color: var(--sq-success);
      font-weight: 600;
    }
    .coverage-fail {
      color: var(--sq-fail);
      font-weight: 600;
    }

    /* Swatch borders */
    .status-success {
      border-color: #b2e6b2;
    }
    .status-fail {
      border-color: #e6b2b2;
    }
    .ignored-swatch {
      border-color: #b2cbe6;
    }

    /* Hide highlights when disabled */
    .highlight-off tr.covered td.code,
    .highlight-off tr.missed td.code,
    .highlight-off tr.ignored td.code {
      background: none !important;
    }

    /* Legend */
    .legend {
      margin-bottom: 18px;
      font-size: 14px;
      display: flex;
      gap: 24px;
      align-items: center;
    }
    .legend-swatch {
      display: inline-block;
      width: 18px;
      height: 18px;
      border-radius: 3px;
      margin-right: 6px;
      vertical-align: middle;
      border: 1px solid #bbb;
    }

    /* Expandable content */
    .expandable-content pre {
      white-space: pre-wrap;
      word-break: break-word;
      width: 100%;
      box-sizing: border-box;
      border: 1px solid #bbb;
      border-radius: 4px;
      background: #fff;
      padding: 10px 12px;
      margin-top: 10px;
    }

    /* Utilities */
    .muted {
      color: var(--sq-muted);
      font-size: 0.95em;
    }

    /* Button animations */
    .btn-animate svg { 
      transition: filter 0.2s, transform 0.2s; 
      filter: drop-shadow(0 0 2px var(--sq-primary)); 
      transform: scale(1.15); 
    }
    .eye-closed svg { 
      opacity: 0.7; 
    }

    /* Layout and positioning classes */
    .text-center { text-align: center; }
    .flex { display: flex; }
    .flex-center { display: flex; align-items: center; }
    .flex-between { display: flex; align-items: center; justify-content: space-between; }
    .flex-1 { flex: 1; }

    /* Spacing utilities */
    .mb-12 { margin-bottom: 12px; }
    .mb-18 { margin-bottom: 18px; }
    .mt-16 { margin-top: 16px; }
    .mt-8 { margin-top: 8px; }
    .mr-6 { margin-right: 6px; }
    .mr-8 { margin-right: 8px; }
    .mr-10 { margin-right: 10px; }
    .mr-12 { margin-right: 12px; }
    .ml-8 { margin-left: 8px; }
    .ml-12 { margin-left: 12px; }
    .pt-15 { padding-top: 15px; }
    .p-summary { padding: 10px 12px; }
    .pr-24 { padding-right: 24px; }

    /* Button styles */
    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    .eye-btn { padding: 0 8px 0 8px; }
    .copy-btn-left { padding: 0 8px 0 0; }
    .copy-btn-right { padding: 0 0 0 8px; }

    /* Policy control styles */
    .policy-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 18px;
    }

    /* Uncovered lines styling */
    .has-uncovered {
      color: var(--sq-fail) !important;
      font-weight: bold !important;
    }

    /* Summary styles */
    .policy-summary {
      list-style: none;
      outline: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 10px 12px;
    }
    .policy-title {
      margin: 0;
      flex: 1;
      font-size: 16px;
    }
    .policy-path {
      font-weight: 400;
      font-size: 13px;
      color: var(--sq-muted);
    }
    .policy-percentage {
      margin-left: 8px;
      color: var(--sq-muted);
      font-size: 14px;
    }
    .policy-metric {
      margin-left: 12px;
      color: var(--sq-muted);
      font-size: 13px;
    }

    /* Code wrapper */
    .code-wrap {
      background: #fafbfc;
      border-radius: 6px;
      padding: 10px 12px;
      margin-top: 8px;
    }

    /* Code table styles */
    .code-table {
      width: 100%;
      border-collapse: collapse;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.45;
    }

    /* Line number links */
    .ln a {
      color: inherit;
      text-decoration: none;
    }

    /* Expandable header */
    .expandable-header {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    /* SVG icons */
    .svg-block { display: block; }

    /* Legend spacing */
    #verbose-legend { margin: 10px 0 24px 0; }

    /* Tooltip styles */
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
      transform: translateY(-5px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .tooltip.show {
      opacity: 1;
      transform: translateY(0);
    }
    .tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: rgba(0, 0, 0, 0.9);
    }

</style>
</head>
<body>
  <div id="header">
    <header>
      Polly Rego Testing & Coverage Report
      <svg class="header-logo" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="20" cy="20" r="18" stroke="white" stroke-width="2" fill="none"/>
        <text x="20" y="26" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif">P</text>
      </svg>
    </header>
  </div>
  <main>
    <div id="coverage-main" class="card main-section">
    <h1 class="text-center">Policy Coverage Summary</h1>
    <table id="coverage-summary" class="summary-table mb-12">
        <tbody>
            <tr>
                <td class="pr-24"><strong>Total Policies:</strong></td>
                <td id="totalPolicies">10</td>
                <td class="pr-24"><strong>Total coverage:</strong></td>
                <td id="totalCoveragePercentage">10%</td>
            </tr>
            <tr>
                <td class="pr-24"><strong>Covered lines:</strong></td>
                <td id="totalCoveredLines">10</td>
                <td class="pr-24"><strong>Not covered lines:</strong></td>
                <td id="totalNotCoveredLines">10</td>
            </tr>
        </tbody>
    </table>
    <h2 class="text-center">Coverage Details</h2>
        <!-- Legend for code highlights -->
        <div class="legend mb-18">
          <span><span class="legend-swatch status-success"></span>Covered line</span>
          <span><span class="legend-swatch status-fail"></span>Not covered line</span>
          <span><span class="legend-swatch ignored-swatch"></span>Ignored line</span>
        </div>
        <!-- Expand/Collapse/Auto buttons for policy cards -->
        <div class="policy-controls">
          <button id="coverage-btn-auto" type="button">Expand Automatic</button>
          <button id="coverage-btn-expand" type="button">Expand All</button>
          <button id="coverage-btn-collapse" type="button">Collapse All</button>
        </div>
        <ul id="coverage-details">
      <li>
        <!-- Expandable/collapsible policy card -->
        <details class="card mt-16" open>
          <summary class="policy-summary">
            <span class="toggle-icon mr-6">
              <svg viewBox="0 0 16 16" width="16" height="16" class="svg-block"><polyline points="6,4 10,8 6,12" fill="none" stroke="#888" stroke-width="2"/></svg>
            </span>
            <span class="mr-10">&#128196;</span>
            <h2 class="policy-title">payment.rego <span class="policy-path">(policies/payment.rego)</span></h2>
            <button class="eye-btn icon-btn" title="Toggle highlight" aria-label="Toggle highlight">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Toggle coverage highlight on and off</title><path d="M10 4C5.45455 4 2.27273 8.18182 2.27273 10C2.27273 11.8182 5.45455 16 10 16C14.5455 16 17.7273 11.8182 17.7273 10C17.7273 8.18182 14.5455 4 10 4Z" stroke="#888" stroke-width="1.5"/><circle cx="10" cy="10" r="3" stroke="#888" stroke-width="1.5"/></svg>
            </button>
            <button class="copy-btn copy-btn-left icon-btn" title="Copy code" aria-label="Copy code">
              <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Copy policy to clipboard</title><rect x="5" y="5" width="10" height="12" rx="2" stroke="#888" stroke-width="1.5" fill="#fff"/><rect x="8" y="2" width="7" height="12" rx="2" stroke="#bbb" stroke-width="1.2" fill="#f7f7f7"/></svg>
            </button>
            <span class="covered-percentage policy-percentage">75%</span>
            <span class="uncovered-lines policy-metric"><strong>Uncovered lines:</strong> 25</span>
            <span class="covered-lines policy-metric"><strong>Covered lines:</strong> 75</span>
            <span class="total-lines policy-metric"><strong>Total lines:</strong> 100</span>
          </summary>
          <div class="code-wrap">
            <table class="code-table">
              <tbody>
                <tr class="covered">
                <td class="ln"><a id="L1" href="#L1">1</a></td>
                <td class="code">package payment</td>
                </tr>
                <tr class="ignored">
                <td class="ln"><a id="L2" href="#L2">2</a></td>
                <td class="code">default allow = false</td>
                </tr>
                <tr class="covered">
                <td class="ln"><a id="L3" href="#L3">3</a></td>
                <td class="code">allow &#123;</td>
                </tr>
                <tr class="covered">
                <td class="ln"><a id="L4" href="#L4">4</a></td>
                <td class="code">    input.amount &lt; 1000</td>
                </tr>
                <tr class="missed">
                <td class="ln"><a id="L5" href="#L5">5</a></td>
                <td class="code">    input.user == "manager"</td>
                </tr>
                <tr class="covered">
                <td class="ln"><a id="L6" href="#L6">6</a></td>
                <td class="code">&#125;</td>
                </tr>
              </tbody>
            </table>
          </div>
        </details>
      </li>
    </ul>

    <div id="coverage-raw" class="pt-15">
      <details class="expandable">
        <summary class="expandable-header">
          <span class="toggle-icon mr-6">
            <svg viewBox="0 0 16 16" width="16" height="16" class="svg-block"><polyline points="6,4 10,8 6,12" fill="none" stroke="#888" stroke-width="2"/></svg>
          </span>
          <span class="flex-1">Expand for raw coverage report.</span>
          <button class="copy-btn copy-btn-right icon-btn" title="Copy content" aria-label="Copy content">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Copy to clipboard</title><rect x="5" y="5" width="10" height="12" rx="2" stroke="#888" stroke-width="1.5" fill="#fff"/><rect x="8" y="2" width="7" height="12" rx="2" stroke="#bbb" stroke-width="1.2" fill="#f7f7f7"/></svg>
          </button>
        </summary>
        <div class="expandable-content">
          <pre></pre>
        </div>
      </details>
    </div>
        </ul>
    </div>
    <div id="verbose-main" class="card main-section">
        <div>
            <h2 class="text-center">Verbose Details</h2>
            <div id="verbose-details">

            <div class="legend" id="verbose-legend">
              <span><span class="legend-swatch status-success"></span>PASS</span>
              <span><span class="legend-swatch status-fail"></span>FAIL</span>
              <span><span class="legend-swatch time-slow"></span>Time &gt; 100ms</span>
            </div>

            <table id="table-verbose" class="summary-table">
                <thead>
                    <tr>
                        <th>Test</th>
                        <th>Status</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be dynamically inserted here -->
                    <!-- Example static row for illustration: -->
                    <tr>
                        <td>order_service/invoice/allow</td>
                        <td class="status-pass">PASS</td>
                        <td>12</td>
                    </tr>
                    <tr>
                        <td>order_service/invoice/deny</td>
                        <td class="status-fail">FAIL</td>
                        <td>8</td>
                    </tr>
                    <tr>
                        <td>order_service/invoice/slow</td>
                        <td class="status-pass">PASS</td>
                        <td class="time-slow">120</td>
                    </tr>
                </tbody>
            </table>            
          </div>
          <div id="verbose-raw" class="pt-15">
            <details class="expandable">
              <summary class="expandable-header">
                <span class="toggle-icon mr-6">
                  <svg viewBox="0 0 16 16" width="16" height="16" class="svg-block"><polyline points="6,4 10,8 6,12" fill="none" stroke="#888" stroke-width="2"/></svg>
                </span>
                <span class="flex-1">Expand for more verbose info</span>
                <button class="copy-btn copy-btn-right icon-btn" title="Copy content" aria-label="Copy content">
                  <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Copy to clipboard</title><rect x="5" y="5" width="10" height="12" rx="2" stroke="#888" stroke-width="1.5" fill="#fff"/><rect x="8" y="2" width="7" height="12" rx="2" stroke="#bbb" stroke-width="1.2" fill="#f7f7f7"/></svg>
                </button>
              </summary>
              <div class="expandable-content">
                <pre></pre>
              </div>
            </details>
          </div>
        </div>
    </div>

    <div id="footer" class="text-center">
        <pre>    Welcome to Polly Rego Policy Coverage Report utility!

            :::::::::::::::::::::::::::------::.+#+=::::::::::::::::::::::::::::::
            ::::::::::::::::::::::::-+*********+=:*##*::::::::::::::::::::::::::::
            ::::------------------=*#**************#*#=:-====-::::::::::::::::::::
            :::++++++++++++++++++*#***************##*##*********=:::::::::::::::::
            ::-*+++++++++==++++=*#*##***************************#*-.::::::::::::::
            ::-*+++++++=--=+++++####***************#**************#-::::::::::::::
            ::-*++=-++=:-=++++++*+#****************#***************#+-::::=+::::::
            ::-*++=:---=++++++++++#**********#*====#*******************++**#=:::::
            ::-*++++--++++++++++++##**********-=====*******##**************#+:::::
            ::-*++++++++=-=+++++*#**#*******##====+++**+++=*#*************#+::::::
            ::-*++==++=--=++++++#*#*+++++++++===========---+#*************#+::::::
            ::-*++=:--:=+++++++*#*#***+=-===-====*******+===****************#-::::
            ::-*+++=--=+++++++++%#+==+*#+======**+++++=+**=-=*#***************::::
            ::-*++++++++=-=++++#**=+=-=*#*====#*++=---++=*#==-=*##***********#-:::
            ::-*++==+++-:-++++*#*#+-...-*#==-**++:.::::=*=#+===+#************#::::
            ::-*++=:==:-=+++++##*#*:-++-+#*++#+*::+*+-::*=*#***##***********#+::::
            ::-*+++=::=+++++++#*=#*:*%%*+%***#*+:+%%%*::*=#*===#**********##=:::::
            ::-*++++=++++==++++#**+=*%#*+++++##*:*%#%*:+++#==+##*********#=:::::::
            ::-*+++++++=--=+++=*#+=+**==---===*#+=*#*==++#+===++##******#=..::::::
            ::-*++=-==--=++++++*=+***======+=-=+#**++****======-*#*****#-.:-::::::
            ::-*+++-::-++++++++*-==#=-=========-+#***++=========#******#==*#::::::
            ::-*++++==+++++++++#+-=#=-==========#*=++-=========+#*********#+::::::
            :::+++++++++++++++++#+=+*=-+***#####%+-*+-======-=*#****##****+:::::::
            ::::--------====-----=+++*+*=*+%#**#*-=*========*##**##*##+--:::::::::
            ::::::::::-*****+-:::::-=+*+=+*+***+=+*=====++*##*%#*##+==::::::::::::
            :::::::::-#*******:::::::::-==+*++++*+===++#+:-=+++---::::::::::::::::
            ::::::::.-#*****##+=::::::::..-#===========**-:..:::::::::::::=+**-:::
            ::::::::=*****#*+++**:::::::-+#+-========++****+=:::::::::::=**++*+:::
            :::::::=#+++++#+++*+#-.:::-+*#*+======++++**++++**=:::::::-**++++#-:::
            :::::::-#*****#****+#+==+**+#*++++++++++++#+++++++*+:::::=*+++++#=::::
            :::::::=#+++++*#*#+++++*+++**+++++++++++++#++++++++**-::=#+++++#++++::
            :::::::=#++***#**##**++++++#++++++++++++++#++++++++++*--#+++++##*++#::
            ::::::::-**+*##******#*+++**++++++++++++++*#*****+++++*#++++*#*+++#=::
            ::::::::::-*#*********#++*#*++++++++++*****+++++++++++*#+++**++++*=:::
            :::::::::::+**********#*+==#++++++++***++++++++++++++++#*+**+++**-::::
            :::::::::::=#***#####**=---**+++++***+***++++++++++++++**++++**=::::::
            :::::::::::-+*#*+++==------=***++**+**++***++++++++++***+++**+-::--:::
            ===========+++============-:::-+*#+#*+*#*+++***++++*##*++**+==========
            =========++=-==++=-----:--=+-::.=#**+*#+++*#*****+++++**+=============
            ======+++-::=+-+++=++++=====+:-==-=**#****++==---::::-+#+++++++++=====
            ====+*+-:::::+=:::------==+=+==-::::--==-::::::::::-==-+*+============
            ====#========-====-------=+*=-:::::::::::::::::::-==-=-=#**+==========
            ===*#===----======-------==-:::::::::::::::::::-==--=-=+*#*+==========
            ==+###****++==---==-:.:==-:::::::::::::::::::-==-=--=**#*+============
            ====++****###**++==++=*+=======---:::::::::-==-==-=**#*+==============
            ==========+++**#####%%*+===---=======-:::-==-=--=**#*+================
            ================+**######***++==----====+=-==-=*##*+==================
            ==================+++++++***###**++==--=+--==*##*+====================
            ===========================+++***###**+=+==*##*+======================
            =================================++***###*##*+========================
            ======================================++***+==========================
            Created by @willemevenwel on GitHub
        </pre>
    </div>

  </main>

</body>
</html>
